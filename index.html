<html lang="en">
<head>
	<style type="text/css">
	body {
		padding: 0px;
		margin: 0px;
		background: #000;
	}
	canvas#game {
		display: block;
		margin: 2em auto 0em auto;
	}
	</style>
</head>
<body>
	<canvas id="game" width="448" height="512"></canvas>
	<script>
	
	const ALIEN_SMALL = [[0,0,0,1,1,0,0,0,
			      0,0,1,1,1,1,0,0,
			      0,1,1,1,1,1,1,0,
			      1,1,0,1,1,0,1,1,
			      1,1,1,1,1,1,1,1,
			      0,1,0,1,1,0,1,0,
			      1,0,0,0,0,0,0,1,
			      0,1,0,0,0,0,1,0],
			     [0,0,0,1,1,0,0,0,
			      0,0,1,1,1,1,0,0,
			      0,1,1,1,1,1,1,0,
			      1,1,0,1,1,0,1,1,
			      1,1,1,1,1,1,1,1,
			      0,0,1,0,0,1,0,0,
			      0,1,0,1,1,0,1,0,
			      1,0,1,0,0,1,0,1]];
	
	const ALIEN_MEDIUM = [[0,0,1,0,0,0,0,0,1,0,0,
			       0,0,0,1,0,0,0,1,0,0,0,
			       0,0,1,1,1,1,1,1,1,0,0,
			       0,1,1,0,1,1,1,0,1,1,0,
			       1,1,1,1,1,1,1,1,1,1,1,
			       1,0,1,1,1,1,1,1,1,0,1,
			       1,0,1,0,0,0,0,0,1,0,1,
			       0,0,0,1,1,0,1,1,0,0,0],
			      [0,0,1,0,0,0,0,0,1,0,0,
			       1,0,0,1,0,0,0,1,0,0,1,
			       1,0,1,1,1,1,1,1,1,0,1,
			       1,1,1,0,1,1,1,0,1,1,1,
			       1,1,1,1,1,1,1,1,1,1,1,
			       0,1,1,1,1,1,1,1,1,1,0,
			       0,0,1,0,0,0,0,0,1,0,0,
			       0,1,0,0,0,0,0,0,0,1,0]];

	const ALIEN_LARGE = [[0,0,0,0,1,1,1,1,0,0,0,0,
			      0,1,1,1,1,1,1,1,1,1,1,0,
			      1,1,1,1,1,1,1,1,1,1,1,1,
			      1,1,1,0,0,1,1,0,0,1,1,1,
			      1,1,1,1,1,1,1,1,1,1,1,1,
			      0,0,0,1,1,0,0,1,1,0,0,0,
			      0,0,1,1,0,1,1,0,1,1,0,0,
			      1,1,0,0,0,0,0,0,0,0,1,1],
			     [0,0,0,0,1,1,1,1,0,0,0,0,
			      0,1,1,1,1,1,1,1,1,1,1,0,
			      1,1,1,1,1,1,1,1,1,1,1,1,
			      1,1,1,0,0,1,1,0,0,1,1,1,
			      1,1,1,1,1,1,1,1,1,1,1,1,
			      0,0,1,1,1,0,0,1,1,1,0,0,
			      0,1,1,0,0,1,1,0,0,1,1,0,
		 	      0,0,1,1,0,0,0,0,1,1,0,0]];

	const PLAYER = [0,0,0,0,0,1,0,0,0,0,0,
		        0,0,0,0,1,1,1,0,0,0,0,
		        0,0,0,0,1,1,1,0,0,0,0,
		        0,1,1,1,1,1,1,1,1,1,0,
		        1,1,1,1,1,1,1,1,1,1,1,
		        1,1,1,1,1,1,1,1,1,1,1,
		        1,1,1,1,1,1,1,1,1,1,1,
		        1,1,1,1,1,1,1,1,1,1,1];

	class Alien {
		constructor(x, y, width, height, bitmaps) {
			this.x = x;
			this.y = y;
			this.frame = 0;
			this.width = width;
			this.height = height;
			this.bitmaps = bitmaps;
		}

		get bitmap() {
			return this.bitmaps[Math.floor(this.frame % 2)];	
		}

		draw() {
			drawBitmap(this.x, this.y, this.width, this.height, this.bitmap, Game.ctx, Game.scale);
		}
		
		move(directionX, directionY) {
			this.x += directionX;
			this.y += directionY;
			this.frame++;
		}
	}

	class AlienSmall extends Alien {
		constructor (x, y) {
			super(x, y, 8, 8, ALIEN_SMALL);
		}
	}

	class AlienMedium extends Alien {
		constructor (x, y) {
			super(x, y, 11, 8, ALIEN_MEDIUM);
		}
	}

	class AlienLarge extends Alien {
		constructor (x, y) {
			super(x, y, 12, 8, ALIEN_LARGE);
		}	
	}

	var Player = {
		x: 106,
		y: 248,
		width: 11,
		height: 8,
		speed: 2,
		bitmap: PLAYER,
		move (directionX) {
			if (directionX > 0) {
				this.x += this.speed;
			} else if (directionX < 0) {
				this.x -= this.speed;
			}	
		},
		draw() {
			drawBitmap(this.x, this.y, this.width, this.height, this.bitmap, Game.ctx, Game.scale)
		}
	}

	var Swarm = {
		x: 24,
		y: 0,
		width: 0,
		direction: {
				x: 2,
				y: 0
			   },
		aliens: [],
		draw() {
			for (let i=0; i<this.aliens.length; i++) {
				this.aliens[i].draw();
			}	
		},
		move() {
			this.update();

			for (let i=0; i<this.aliens.length; i++) {
				this.aliens[i].move(this.direction.x, this.direction.y);
			}
		},
		update() {
			for (let i=0; i<this.aliens.length; i++) {
				this.width = 0;
		
				if (this.aliens[i].x + this.aliens[i].width > this.width) {
					this.width = this.aliens[i].x + this.aliens[i].width;
				}	
			}
			
			if (this.width + this.direction.x > Game.width && Math.floor(this.y % 2) == 0) {
				this.direction.y = 3;
				this.direction.x = 0;
				this.y += this.direction.y;
			} else if (this.x <= 0 && Math.floor(this.y % 2) !== 0) {
				this.direction.y = 3;
				this.direction.x = 0;
				this.y += this.direction.y; 
			} else {
				this.direction.y = 0;
				this.direction.x = Math.floor(this.y % 2) == 0 ? 2 : -2;
				this.x += this.direction.x;
			}	
		},
		build() {
			for(let i=0; i<11; i++) {
				this.aliens.push(new AlienSmall((i * 16) + 2 + this.x, 0));
			}	
		
			for(let i=0; i<22; i++) {
				this.aliens.push(new AlienMedium((Math.floor(i % 11) * 16) + 1 + this.x, 16 + Math.floor(i / 11) * 16));
			}

			for(let i=0; i<22; i++) {
				this.aliens.push(new AlienLarge(Math.floor(i % 11) * 16 + this.x, 48 + Math.floor(i / 11) * 16));
			} 
		}
	}

	var Game = {
		canvas: null,
		ctx: null,
		scale: 2,
		width: 224,
		height: 256,
		canvasHeight: 512,
		canvasWidth: 512,
	}

	function putPixel(x, y, context, scale) {
		if (y >= 248) {
			context.fillStyle = '#00FF00';
		} else {
			context.fillStyle = '#FFFFFF';
		}
		context.fillRect(x * scale, y * scale, scale, scale);
	}

	function drawBitmap(x, y, width, height, bitmap, context, scale) {
		for (let i=0; i<width*height; i++) {
			if (bitmap[i] == 1) {
				putPixel(Math.floor(i % width) + x, 
					 Math.floor(i / width) + y, 
					 context, 
					 scale); 
			}
		}
	}

	function setupGame() {
		Game.canvas = document.getElementById("game");
		Game.ctx = Game.canvas.getContext("2d");

		Swarm.build();
		Swarm.draw();
	
		window.addEventListener("keydown", function (e) {
			switch (e.keyCode) {
				case 37:
					Player.x -= Player.speed;
					break;
				case 39:
					Player.x += Player.speed;
					break;
				default:
					console.log(e.keyCode);
					break;
			}
		});

		window.addEventListener("keyup", function (e) {
			Player.speed = 2;
		});

		setInterval(gameLoop, 1000 / 60);
		setInterval(function () {
			Swarm.move();	
		}, 1000);
	}

	function gameLoop() {
		Game.ctx.clearRect(0, 0, Game.canvasWidth, Game.canvasHeight);
		Player.draw();
		Swarm.draw();
	}

	setupGame();

	</script>
</body>
<html>
